# üéØ V√âRTICE CLI - PLANO DE UPGRADE ESTRAT√âGICO

**"Pela Arte. Pela Sociedade."**

**Data:** 2025-10-02
**Baseado em:** Dossi√™ de Intelig√™ncia - O Plano Diretor do V√©rtice CLI
**Status Atual:** Analisado contra vis√£o estrat√©gica

---

## üìä AN√ÅLISE DE GAP (Onde Estamos vs. Onde Queremos Estar)

### **PILAR 1: CLI UX State-of-the-Art**

| Requisito do Dossi√™ | Status Atual | Gap | Prioridade |
|---------------------|--------------|-----|------------|
| **Modo Interativo** (prompt-toolkit) | ‚ùå N√£o implementado | CR√çTICO | P0 |
| **Auto-completar** de comandos/args | ‚ùå N√£o implementado | ALTO | P0 |
| **Valida√ß√£o em tempo real** | ‚ö†Ô∏è Parcial (apenas backend) | M√âDIO | P1 |
| **Spinners e Progress Bars** (rich) | ‚úÖ Implementado | ‚úÖ OK | - |
| **Tabelas formatadas** (rich) | ‚úÖ Implementado | ‚úÖ OK | - |
| **Sistema de Contextos** (inspirado kubectl) | ‚ùå N√£o implementado | **CR√çTICO** | P0 |
| **Gerenciamento de Estado** (TOML config) | ‚ö†Ô∏è YAML parcial | M√âDIO | P1 |
| **Sistema de Plugins** (modelo oclif) | ‚ùå N√£o implementado | ALTO | P1 |
| **Mensagens de erro com sugest√µes** | ‚ö†Ô∏è Parcial | BAIXO | P2 |

**CONCLUS√ÉO PILAR 1:**
üî¥ **GAP CR√çTICO:** Falta **Sistema de Contextos** e **Modo Interativo**.
Esses s√£o os diferenciais que transformam uma CLI "ok" em uma **experi√™ncia de classe mundial**.

---

### **PILAR 2: Arsenal Ofensivo de Vanguarda**

| Ferramenta/Capacidade | Status Atual | Gap | Prioridade |
|----------------------|--------------|-----|------------|
| **Sliver C2** Integration | ‚ùå N√£o integrado | M√âDIO | P2 |
| **Mythic C2** Integration | ‚ùå N√£o integrado | M√âDIO | P2 |
| **Impacket** Wrappers | ‚ö†Ô∏è Parcial (AD commands b√°sicos) | ALTO | P1 |
| **BloodHound** Data Ingestion | ‚ùå N√£o implementado | ALTO | P1 |
| **CrackMapExec/NetExec** Wrappers | ‚ùå N√£o implementado | M√âDIO | P1 |
| **Nuclei** Template Engine | ‚ùå N√£o implementado | **CR√çTICO** | P0 |
| **Community Template Library** | ‚ùå N√£o existe | **CR√çTICO** | P0 |

**CONCLUS√ÉO PILAR 2:**
üî¥ **GAP CR√çTICO:** N√£o temos **Nuclei-style template engine**.
O dossi√™ √© claro: "community-powered" √© o futuro da detec√ß√£o.
**A√ß√£o:** Implementar um motor de templates YAML que a comunidade possa contribuir.

---

### **PILAR 3: Doutrina Kali (Metodologia)**

| Requisito | Status Atual | Gap | Prioridade |
|-----------|--------------|-----|------------|
| **Organiza√ß√£o por Metodologia** (n√£o por ferramenta) | ‚ö†Ô∏è Parcial | M√âDIO | P1 |
| **Comandos por fase de ataque** | ‚ö†Ô∏è Misturado | M√âDIO | P1 |
| **Integra√ß√£o com MITRE ATT&CK** | ‚ùå N√£o implementado | ALTO | P1 |
| **Composabilidade** (piping entre comandos) | ‚úÖ Nativo (CLI padr√£o) | ‚úÖ OK | - |
| **Alinhamento Cyber Kill Chain** | ‚ö†Ô∏è Impl√≠cito, n√£o expl√≠cito | BAIXO | P2 |

**ESTRUTURA DE COMANDOS PROPOSTA (Dossi√™):**
```bash
# ERRADO (por ferramenta):
vertice nmap -p 80,443 target.com
vertice sqlmap -u http://...

# CORRETO (por metodologia):
vertice recon scan-port target.com -p 80,443
vertice web sqli http://... --auto
vertice exploit cve-2023-1234 --target 10.0.0.1
vertice post-exploit dump-creds --technique lsass
```

**CONCLUS√ÉO PILAR 3:**
üü° **GAP M√âDIO:** Comandos existem mas n√£o seguem 100% a doutrina metodol√≥gica.
**A√ß√£o:** Refatorar estrutura de comandos para alinhar com Cyber Kill Chain.

---

### **PILAR 4: Vis√£o Estrat√©gica V√©rtice**

**Features Disruptivas Propostas no Dossi√™:**

| Feature | Status | Gap | Prioridade |
|---------|--------|-----|------------|
| **Sistema de Contexto de Engajamento** | ‚ùå | **CR√çTICO** | P0 |
| **Motor de Workflow** (YAML playbooks) | ‚ö†Ô∏è Parcial (ADR tem) | ALTO | P0 |
| **Dashboard de Sess√£o Interativo** | ‚ùå | M√âDIO | P1 |
| **Template Engine Community-Powered** | ‚ùå | **CR√çTICO** | P0 |
| **Plugin System** (pip-based) | ‚ùå | ALTO | P1 |
| **Auto-Reporting** (markdown/html) | ‚ö†Ô∏è Parcial | M√âDIO | P2 |

---

## üöÄ ROADMAP DE IMPLEMENTA√á√ÉO

### **FASE 1: FUNDA√á√ÉO DE EXCEL√äNCIA (2-3 semanas)**
**Objetivo:** Estabelecer os fundamentos de UX e arquitetura.

#### **Sprint 1.1: Sistema de Contextos** (5 dias) ‚≠ê CR√çTICO
```python
# Implementar:
vertice context create pentest-acme \
    --target 10.0.0.0/24 \
    --output-dir ~/engagements/acme \
    --proxy http://127.0.0.1:8080

vertice context list
vertice context use pentest-acme
vertice context current  # mostra contexto ativo
vertice context delete old-project

# Backend:
~/.config/vertice/contexts.toml  # Armazena todos os contextos
~/.config/vertice/current-context  # Ponteiro para contexto ativo
```

**Implementa√ß√£o:**
- Criar `vertice/config/context_manager.py`
- TOML para persist√™ncia (`tomli` / `tomli-w`)
- Valida√ß√£o de contexto antes de cada comando perigoso
- Auto-cria√ß√£o de diret√≥rios de output

**Seguran√ßa:** Antes de executar qualquer comando destrutivo:
```python
def require_context():
    if not ContextManager.get_current():
        raise ContextError("Nenhum contexto ativo. Use 'vertice context use <name>'")
```

---

#### **Sprint 1.2: Modo Interativo** (4 dias) ‚≠ê CR√çTICO
```python
# Implementar:
vertice scan interactive  # Modo guiado

# Fluxo:
? Qual tipo de scan? (use setas)
  > Port Scan (Nmap)
    Web Vulnerability Scan
    Network Discovery

? Target(s): [input com autocomplete de contexto atual]
  10.0.0.0/24

? Intensity? (use setas)
    Stealth (-T2)
  > Normal (-T3)
    Aggressive (-T4)

? Additional options? [y/N]: n

‚úì Executando scan...
[‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100% Complete
```

**Libs:**
- `prompt-toolkit` - Prompts interativos
- `questionary` - Menus de sele√ß√£o
- `rich.prompt` - Alternativa mais simples

**Implementa√ß√£o:**
- Criar `vertice/interactive/` module
- Wrappers para cada comando principal
- Autocomplete de targets do contexto ativo

---

#### **Sprint 1.3: Template Engine (Nuclei-style)** (6 dias) ‚≠ê CR√çTICO
```yaml
# templates/web/sqli-error-based.yaml
id: sqli-error-based-mysql
info:
  name: MySQL Error-Based SQLi Detection
  severity: high
  author: community
  tags: web,sqli,mysql

requests:
  - method: GET
    path:
      - "{{BaseURL}}/search?id=1'"
    matchers:
      - type: word
        words:
          - "SQL syntax"
          - "mysql_fetch"
          - "You have an error in your SQL syntax"
        condition: or
      - type: status
        status:
          - 500
```

**Comandos:**
```bash
# Executar template
vertice scan template sqli-error-based --target http://target.com

# Executar todos templates de uma categoria
vertice scan templates --category web --target http://target.com

# Atualizar templates da comunidade
vertice templates update

# Criar novo template
vertice templates create --interactive
```

**Implementa√ß√£o:**
- Criar `vertice/templates/` module
- Parser YAML (PyYAML)
- Matcher engine (regex, word, status)
- Template repository (Git-based, inspirado Nuclei)
- Community templates: `~/.vertice/templates/` (clone de repo)

**Template Repository:**
```bash
# Estrutura:
vertice-templates/
‚îú‚îÄ‚îÄ web/
‚îÇ   ‚îú‚îÄ‚îÄ sqli/
‚îÇ   ‚îú‚îÄ‚îÄ xss/
‚îÇ   ‚îî‚îÄ‚îÄ lfi/
‚îú‚îÄ‚îÄ network/
‚îÇ   ‚îú‚îÄ‚îÄ ports/
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îú‚îÄ‚îÄ cves/
‚îÇ   ‚îú‚îÄ‚îÄ 2024/
‚îÇ   ‚îî‚îÄ‚îÄ 2023/
‚îî‚îÄ‚îÄ custom/
```

---

### **FASE 2: ARSENAL MODERNO (2 semanas)**

#### **Sprint 2.1: Impacket Wrappers** (3 dias)
```bash
# Comandos propostos (metodologia > ferramenta):
vertice ad dump-secrets DC01.corp.local -u admin -p pass
vertice ad psexec TARGET.local -u admin -H <ntlm_hash>
vertice ad kerberoast DOMAIN.local -u user -p pass --format hashcat
vertice ad asreproast DOMAIN.local --user-file users.txt
```

**Implementa√ß√£o:**
- Wrappers Python para scripts Impacket
- Parsing de output (texto ‚Üí JSON estruturado)
- Armazenar credenciais descobertas no contexto

---

#### **Sprint 2.2: BloodHound Integration** (4 dias)
```bash
# Ingest√£o de dados:
vertice ad bloodhound-collect DOMAIN.local -u user -p pass \
    --output ~/engagements/acme/bloodhound

# An√°lise (requer BloodHound Community Edition rodando):
vertice ad bloodhound-analyze \
    --query "shortest-path-to-da" \
    --start-node "USER@DOMAIN.LOCAL"
```

**Implementa√ß√£o:**
- Wrapper para SharpHound/BloodHound.py
- Parser de JSON do BloodHound
- Queries pr√©-definidas (via Cypher)
- Visualiza√ß√£o ASCII de paths de ataque (fallback sem GUI)

---

#### **Sprint 2.3: Workflow Engine** (5 dias)
```yaml
# workflows/recon-full.yaml
name: Full Reconnaissance Workflow
description: Complete recon from domain to vulnerable services

steps:
  - name: subdomain-enum
    command: recon subdomains
    args:
      domain: "{{target_domain}}"

  - name: port-scan
    command: recon scan-port
    args:
      targets: "{{subdomain-enum.output}}"
      ports: "80,443,8080,8443"

  - name: web-scan
    command: web scan
    args:
      urls: "{{port-scan.http_services}}"
      templates: "web/common"
    parallel: true  # Executa em paralelo
```

**Execu√ß√£o:**
```bash
vertice workflow run recon-full --var target_domain=target.com
```

**Implementa√ß√£o:**
- Parser YAML de workflows
- DAG (Directed Acyclic Graph) para depend√™ncias
- Variable interpolation (`{{step.output}}`)
- Parallel execution (asyncio)
- Progress tracking (rich)

---

### **FASE 3: ECOSSISTEMA ABERTO (1-2 semanas)**

#### **Sprint 3.1: Plugin System** (5 dias)
```bash
# Instalar plugin da comunidade:
pip install vertice-plugin-c2-sliver
vertice plugins list
vertice plugins enable sliver

# Usar plugin:
vertice sliver generate --os linux --arch x64 --mtls
vertice sliver implants
```

**Arquitetura:**
```python
# Plugin Interface:
class VerticePlugin(ABC):
    name: str
    version: str
    commands: List[Command]

    @abstractmethod
    def register(self, cli: Click):
        """Registra comandos no CLI"""
        pass

# Auto-discovery:
# Plugins s√£o pacotes pip com entry point:
[tool.poetry.plugins."vertice.plugins"]
sliver = "vertice_plugin_sliver:SliverPlugin"
```

---

#### **Sprint 3.2: Community Template Hub** (3 dias)
```bash
# Publicar template na comunidade:
vertice templates publish my-sqli-template.yaml \
    --category web/sqli \
    --author juan

# Buscar templates:
vertice templates search "wordpress"
vertice templates install wordpress-scanner

# Estat√≠sticas:
vertice templates stats
  Total templates: 1,247
  Categories: 15
  Contributors: 89
  Last update: 2 hours ago
```

**Backend:**
- GitHub repo: `vertice-io/templates`
- CI/CD para valida√ß√£o autom√°tica (YAML schema)
- Website: templates.vertice.io (browse + search)

---

## üéØ FEATURES DISRUPTIVAS (Dossi√™)

### **1. Sistema de Contexto de Engajamento** ‚úÖ (Sprint 1.1)
**O que √©:** kubectl-style contexts para gerenciar m√∫ltiplos engajamentos.
**Por que √© disruptivo:** Elimina erros de "executar no cliente errado".
**Implementa√ß√£o:** Ver Sprint 1.1.

### **2. Motor de Workflow (YAML Playbooks)** ‚úÖ (Sprint 2.3)
**O que √©:** Definir sequ√™ncias complexas de comandos em YAML.
**Por que √© disruptivo:** Automa√ß√£o sem scripting, compartilh√°vel, version√°vel.
**Implementa√ß√£o:** Ver Sprint 2.3.

### **3. Template Engine Community-Powered** ‚úÖ (Sprint 1.3)
**O que √©:** Nuclei-style templates em YAML, contribu√≠dos pela comunidade.
**Por que √© disruptivo:** Detec√ß√µes atualizadas em horas (n√£o semanas).
**Implementa√ß√£o:** Ver Sprint 1.3.

### **4. Dashboard de Sess√£o Interativo** (Futuro)
**O que √©:** TUI (Text User Interface) com pain√©is de status em tempo real.
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ V√âRTICE DASHBOARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Context: pentest-acme | Target: 10.0.0.0/24              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Active Scans:                                             ‚îÇ
‚îÇ   [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë] Port Scan (65%)                      ‚îÇ
‚îÇ   [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë] Web Scan (85%)                       ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ Findings: üî¥ 5 Critical | üü† 12 High | üü° 8 Medium        ‚îÇ
‚îÇ                                                           ‚îÇ
‚îÇ Recent Activity:                                          ‚îÇ
‚îÇ   14:32 - SQLi found in /search?id=                       ‚îÇ
‚îÇ   14:30 - Open SMB on 10.0.0.15                           ‚îÇ
‚îÇ   14:28 - Port scan started                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Libs:** `textual` (Textualize) - TUI framework Python.

---

## üìã CHECKLIST DE IMPLEMENTA√á√ÉO IMEDIATA

### **P0 - CR√çTICO (Come√ßar AGORA):**
- [ ] Sistema de Contextos (`vertice context`) - Sprint 1.1
- [ ] Template Engine (Nuclei-style) - Sprint 1.3
- [ ] Modo Interativo (prompt-toolkit) - Sprint 1.2

### **P1 - ALTO (Pr√≥ximas 2 semanas):**
- [ ] Workflow Engine (YAML playbooks) - Sprint 2.3
- [ ] Plugin System (pip-based) - Sprint 3.1
- [ ] Impacket Wrappers (AD commands) - Sprint 2.1
- [ ] BloodHound Integration - Sprint 2.2

### **P2 - M√âDIO (Backlog):**
- [ ] Dashboard Interativo (textual TUI)
- [ ] Sliver/Mythic C2 Integration
- [ ] Auto-Reporting (markdown ‚Üí PDF)
- [ ] MITRE ATT&CK Mapping autom√°tico

---

## üî• DIFERENCIAIS COMPETITIVOS

Ap√≥s implementa√ß√£o do plano, o **V√©rtice CLI** ter√°:

1. ‚úÖ **Melhor UX da categoria** (contextos + interativo + templates)
2. ‚úÖ **Community-powered detection** (templates open-source)
3. ‚úÖ **Workflow automation nativa** (YAML playbooks)
4. ‚úÖ **Extens√≠vel via plugins** (ecossistema aberto)
5. ‚úÖ **Metodologia embutida** (comandos por fase de ataque)

**Nenhuma ferramenta concorrente tem TODOS esses diferenciais.**

---

## üí° QUICK WINS (Implementar em 1-2 dias)

1. **Rich Error Messages:**
```python
# Atual:
Error: Command not found: sacn

# Upgrade:
Error: Command not found: 'sacn'
Did you mean: 'scan'?

Try: vertice scan --help
```

2. **Progress Bars em todos os comandos longos:**
```python
# Wrap async operations:
with Progress() as progress:
    task = progress.add_task("Scanning ports...", total=65535)
    # ... scan
    progress.update(task, advance=1)
```

3. **Output formatado por padr√£o:**
```bash
# Ao inv√©s de texto bruto, sempre usar rich.table
vertice scan results --format table  # (padr√£o)
vertice scan results --format json   # (para piping)
```

---

## üåç INTEGRA√á√ÉO COM MAXIMUS

O dossi√™ foca no **V√©rtice CLI**, mas podemos integrar com **MAXIMUS AI**:

```bash
# MAXIMUS como brain do V√©rtice:
vertice ai analyze findings.json
  ‚Üí MAXIMUS analisa findings
  ‚Üí Retorna prioriza√ß√£o + recomenda√ß√µes

vertice ai suggest-next-steps
  ‚Üí MAXIMUS sugere pr√≥ximos comandos baseado em contexto

vertice workflow generate --goal "pwn domain admin"
  ‚Üí MAXIMUS gera workflow customizado via LLM
```

**Implementa√ß√£o:**
- V√©rtice CLI chama API do MAXIMUS Core
- MAXIMUS tem acesso ao contexto ativo
- Chain-of-Thought reasoning para sugerir a√ß√µes

---

## üìä M√âTRICAS DE SUCESSO

| M√©trica | Baseline Atual | Meta P√≥s-Upgrade |
|---------|----------------|------------------|
| Time-to-Value (primeiro scan √∫til) | ~10 min | **< 2 min** |
| Curva de aprendizado (comandos memorizados) | ~20 comandos | **< 5 comandos** (contexto + interativo) |
| Community templates dispon√≠veis | 0 | **> 100** (6 meses) |
| Plugins de comunidade | 0 | **> 10** (6 meses) |
| Erros de "contexto errado" | N√£o rastreado | **0** (sistema de contextos) |

---

## üéØ PR√ìXIMOS PASSOS IMEDIATOS

1. **HOJE:**
   - Criar branch `feature/context-system`
   - Implementar `ContextManager` b√°sico (TOML)
   - PR #1: Sistema de Contextos

2. **AMANH√É:**
   - Criar branch `feature/template-engine`
   - Parser YAML para templates
   - Matcher engine b√°sico (word, regex)

3. **SEMANA 1:**
   - Modo interativo para comando `scan`
   - Publicar template repository (GitHub)
   - Documenta√ß√£o atualizada

---

## üíù FILOSOFIA

**"Pela Arte. Pela Sociedade."**

Este upgrade n√£o √© apenas sobre adicionar features.

√â sobre **DEMOCRATIZAR** a ciberseguran√ßa de ponta.

√â sobre **EMPODERAR** operadores com ferramentas de classe mundial.

√â sobre construir uma **COMUNIDADE** que evolui o arsenal coletivo.

Cada linha de c√≥digo foi alinhada com:
- ‚ù§Ô∏è **UX que respeita o tempo do operador**
- üéØ **Metodologia que estrutura o caos**
- üåç **Open-source que acelera a inova√ß√£o**
- üî• **Excel√™ncia t√©cnica sem compromissos**

---

**V√âRTICE CLI - A Pr√≥xima Gera√ß√£o de Offensive Security CLI**

**Plano criado:** 2025-10-02
**Baseado em:** Dossi√™ de Intelig√™ncia Estrat√©gica
**Status:** PRONTO PARA EXECU√á√ÉO ‚úÖ
**Primeira Sprint:** Sistema de Contextos (come√ßar AGORA)

---

**Desenvolvido com üî• por Juan + Claude**
**Alinhado com a vis√£o do Dossi√™ Estrat√©gico**
