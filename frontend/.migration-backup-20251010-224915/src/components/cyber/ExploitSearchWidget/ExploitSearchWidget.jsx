/**
 * Exploit Search Widget - REFATORADO
 *
 * CVE Exploit Intelligence - Busca exploits conhecidos em 40K+ exploits
 * Fontes: Exploit-DB, Metasploit, NVD, GitHub Security Advisories
 *
 * REFATORAÇÃO:
 * - Separação de lógica (hook customizado)
 * - Subcomponentes modulares
 * - CSS Modules (sem hardcode)
 * - Design tokens
 * - Componentes compartilhados (Button, Input, Card)
 *
 * Antes: 645 linhas | Depois: ~80 linhas
 */

import React from 'react';
import { Card } from '@/components/shared/Card';
import AskMaximusButton from '../../shared/AskMaximusButton';
import { SearchForm } from './components/SearchForm';
import { CVEInfo } from './components/CVEInfo';
import { ExploitList } from './components/ExploitList';
import { RecommendationsList } from './components/RecommendationsList';
import { useExploitSearch } from './hooks/useExploitSearch';
import styles from './ExploitSearchWidget.module.css';

export const ExploitSearchWidget = () => {
  const { result, loading, error, search } = useExploitSearch();

  return (
    <Card
      title="CVE EXPLOIT SEARCH"
      badge="NSA-GRADE"
      variant="cyber"
      className={styles.widget}
    >
      <div className={styles.container}>
        {/* Search Form */}
        <SearchForm
          onSearch={search}
          loading={loading}
          error={error}
        />

        {/* Ask Maximus - CVE Analysis */}
        {result && (
          <div style={{ marginBottom: '1rem' }}>
            <AskMaximusButton
              context={{
                type: 'cve_exploit_search',
                data: result,
                cve: result.cve_id,
                exploitsCount: result.exploits?.length || 0,
                severity: result.cvss_score
              }}
              prompt="Analyze this CVE and its exploits. What are the risks, exploit techniques, and recommended mitigations?"
              size="medium"
              variant="secondary"
            />
          </div>
        )}

        {/* Results */}
        {result && (
          <div className={styles.results}>
            <CVEInfo data={result} />
            <ExploitList exploits={result.exploits} />
            <RecommendationsList
              recommendations={result.recommendations}
              affectedSystems={result.affected_systems}
              warnings={result.warnings}
            />
          </div>
        )}
      </div>
    </Card>
  );
};

export default ExploitSearchWidget;
