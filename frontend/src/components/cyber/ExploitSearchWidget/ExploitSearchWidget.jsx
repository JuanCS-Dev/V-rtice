/**
 * EXPLOIT SEARCH WIDGET - CVE Exploit Intelligence
 *
 * CVE Exploit Intelligence - Busca exploits conhecidos em 40K+ exploits
 * Fontes: Exploit-DB, Metasploit, NVD, GitHub Security Advisories
 *
 * AI-FIRST DESIGN (Maximus Vision Protocol):
 * - Card wrapper with data-maximus-tool="exploit-search"
 * - <section> for search form
 * - <section> for AI assistance (conditional)
 * - <section> for results (CVE info, exploits, recommendations)
 *
 * Maximus can:
 * - Identify tool via data-maximus-tool="exploit-search"
 * - Monitor search via data-maximus-status
 * - Access search form via data-maximus-section="search-form"
 * - Interpret CVE intelligence via semantic structure
 *
 * REFATORAÇÃO:
 * - Separação de lógica (hook customizado)
 * - Subcomponentes modulares
 * - CSS Modules (sem hardcode)
 * - Design tokens
 * - Componentes compartilhados (Button, Input, Card)
 *
 * Antes: 645 linhas | Depois: ~80 linhas
 * @version 2.0.0 (Maximus Vision)
 * @author Gemini + Maximus Vision Protocol
 * i18n: Ready for internationalization
 * @see MAXIMUS_VISION_PROTOCOL_HTML_BLUEPRINT.md
 */

import React from 'react';
import { Card } from '@/components/shared/Card';
import AskMaximusButton from '../../shared/AskMaximusButton';
import { SearchForm } from './components/SearchForm';
import { CVEInfo } from './components/CVEInfo';
import { ExploitList } from './components/ExploitList';
import { RecommendationsList } from './components/RecommendationsList';
import { useExploitSearch } from './hooks/useExploitSearch';
import styles from './ExploitSearchWidget.module.css';

export const ExploitSearchWidget = () => {
  const { result, loading, error, search } = useExploitSearch();

  return (
    <Card
      title="CVE EXPLOIT SEARCH"
      badge="NSA-GRADE"
      variant="cyber"
      className={styles.widget}
      data-maximus-tool="exploit-search"
      data-maximus-category="shared"
      data-maximus-status={loading ? 'searching' : 'ready'}
    >
      <div className={styles.container}>
        <section
          role="region"
          aria-label="CVE search form"
          data-maximus-section="search-form">
          <SearchForm
            onSearch={search}
            loading={loading}
            error={error}
          />
        </section>

        {result && (
          <section
            style={{ marginBottom: '1rem' }}
            role="region"
            aria-label="AI assistance"
            data-maximus-section="ai-assistance">
            <AskMaximusButton
              context={{
                type: 'cve_exploit_search',
                data: result,
                cve: result.cve_id,
                exploitsCount: result.exploits?.length || 0,
                severity: result.cvss_score
              }}
              prompt="Analyze this CVE and its exploits. What are the risks, exploit techniques, and recommended mitigations?"
              size="medium"
              variant="secondary"
            />
          </section>
        )}

        {result && (
          <section
            className={styles.results}
            role="region"
            aria-label="CVE exploit results"
            data-maximus-section="results">
            <CVEInfo data={result} />
            <ExploitList exploits={result.exploits} />
            <RecommendationsList
              recommendations={result.recommendations}
              affectedSystems={result.affected_systems}
              warnings={result.warnings}
            />
          </section>
        )}
      </div>
    </Card>
  );
};

export default ExploitSearchWidget;
