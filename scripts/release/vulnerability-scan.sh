#!/usr/bin/env bash
set -euo pipefail

# Script: vulnerability-scan.sh
# Autor: Juan Carlo de Souza (JuanCS-DEV @github)
# Colabora√ß√£o: OpenAI (cGPT)
# Descri√ß√£o: Executa an√°lise de vulnerabilidades via Grype, suportando SBOM ou diret√≥rio.

if [[ $# -lt 2 ]]; then
  echo "Uso: $0 <target|sbom> <report_output>" >&2
  exit 1
fi

TARGET="$1"
OUTPUT="$2"

echo "üõ°Ô∏è  Executando Grype em $TARGET"
if command -v grype >/dev/null 2>&1; then
  grype "$TARGET" -o json > "$OUTPUT"
else
  docker run --rm \
    -v "$(pwd)":/workspace \
    anchore/grype:latest \
    "/workspace/$TARGET" \
    -o json > "$OUTPUT"
fi

echo "‚úÖ Relat√≥rio de vulnerabilidades salvo em $OUTPUT"
