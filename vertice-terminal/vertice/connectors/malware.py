from .base import BaseConnector
from typing import Dict, Any
import httpx

class MalwareConnector(BaseConnector):
    """Conector para Malware Analysis Service (porta 8011)"""

    def __init__(self):
        super().__init__(base_url="http://localhost:8011")

    async def health_check(self) -> bool:
        try:
            data = await self._get("/")
            return data.get("status") == "operational"
        except httpx.HTTPStatusError as e:
            print(f"HTTP error during health check: {e}")
            return False
        except httpx.RequestError as e:
            print(f"Network error during health check: {e}")
            return False
        except Exception as e:
            print(f"An unexpected error occurred during health check: {e}")
            return False

    async def scan_file(self, file_path: str) -> Dict[str, Any]:
        """Scan file for malware."""
        # In a real scenario, you'd send the file content, not just the path.
        # For now, we'll simulate by sending the path.
        return await self._post("/api/malware/scan", json={"file_path": file_path})